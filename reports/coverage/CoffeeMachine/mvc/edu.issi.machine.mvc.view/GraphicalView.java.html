<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>GraphicalView.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=8;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (2015-02-11 22:36:32)</a> &gt; <a href="../../index.html" class="el_group">CoffeeMachine</a> &gt; <a href="../index.html" class="el_bundle">mvc</a> &gt; <a href="index.source.html" class="el_package">edu.issi.machine.mvc.view</a> &gt; <span class="el_source">GraphicalView.java</span></div><h1>GraphicalView.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">package edu.issi.machine.mvc.view;</span>

import java.awt.Container;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.Rectangle;
import java.awt.Window.Type;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

import javax.swing.DefaultListModel;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import javax.swing.ListSelectionModel;

import edu.issi.machine.mvc.controller.Controller.IngredientsListener;
import edu.issi.machine.mvc.controller.Controller.OrderListener;
import edu.issi.machine.mvc.controller.Controller.ProductsListener;
import edu.issi.machine.mvc.controller.Controller.PropertiesListener;
import edu.issi.machine.mvc.controller.EventArguments;
import edu.issi.machine.operation.Status;
import edu.issi.machine.product.ingredient.Unit;

/**
 * @author DawidSamolyk
 *
 */
public class GraphicalView implements View {
    private ProductsListener productsListener;
    private PropertiesListener propertiesListener;
    private IngredientsListener ingredientsListener;
    private OrderListener orderListener;
    private JFrame frame;
    private JLabel statusLabel;
<span class="nc" id="L46">    private DefaultListModel&lt;String&gt; productsListModel = new DefaultListModel&lt;String&gt;();</span>
<span class="nc" id="L47">    private DefaultListModel&lt;String&gt; ingredientsListModel = new DefaultListModel&lt;String&gt;();</span>
<span class="nc" id="L48">    private DefaultListModel&lt;String&gt; propertiesListModel = new DefaultListModel&lt;String&gt;();</span>
    private JList&lt;String&gt; productsList;

    /**
     * Create the application.
     */
<span class="nc" id="L54">    public GraphicalView() {</span>
<span class="nc" id="L55">	initialize();</span>
<span class="nc" id="L56">    }</span>

    /**
     * Initialize the contents of the frame.
     */
    private void initialize() {
<span class="nc" id="L62">	frame = new JFrame();</span>
<span class="nc" id="L63">	frame.setBounds(100, 100, 450, 300);</span>
<span class="nc" id="L64">	frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="nc" id="L65">	GridBagLayout frameGridBagLayout = new GridBagLayout();</span>
<span class="nc" id="L66">	frameGridBagLayout.columnWidths = new int[] { 10, 10, 10, 5 };</span>
<span class="nc" id="L67">	frameGridBagLayout.rowHeights = new int[] { 5, 20, 5 };</span>
<span class="nc" id="L68">	frameGridBagLayout.columnWeights = new double[] { 1.0, 1.0, 1.0, 0.0 };</span>
<span class="nc" id="L69">	frameGridBagLayout.rowWeights = new double[] { 1.0, 1.0, 0.0 };</span>
<span class="nc" id="L70">	frame.getContentPane().setLayout(frameGridBagLayout);</span>

<span class="nc" id="L72">	JLabel productsLabel = new JLabel(&quot;Produkty&quot;);</span>
<span class="nc" id="L73">	GridBagConstraints produktyLabelConstraints = new GridBagConstraints();</span>
<span class="nc" id="L74">	produktyLabelConstraints.insets = new Insets(0, 0, 5, 5);</span>
<span class="nc" id="L75">	produktyLabelConstraints.gridx = 0;</span>
<span class="nc" id="L76">	produktyLabelConstraints.gridy = 0;</span>
<span class="nc" id="L77">	frame.getContentPane().add(productsLabel, produktyLabelConstraints);</span>

<span class="nc" id="L79">	JLabel ingredientsLabel = new JLabel(&quot;Sk\u0142adniki&quot;);</span>
<span class="nc" id="L80">	GridBagConstraints ingredientsLabelConstraints = new GridBagConstraints();</span>
<span class="nc" id="L81">	ingredientsLabelConstraints.insets = new Insets(0, 0, 5, 5);</span>
<span class="nc" id="L82">	ingredientsLabelConstraints.gridx = 1;</span>
<span class="nc" id="L83">	ingredientsLabelConstraints.gridy = 0;</span>
<span class="nc" id="L84">	frame.getContentPane().add(ingredientsLabel, ingredientsLabelConstraints);</span>

<span class="nc" id="L86">	JLabel propertiesLabel = new JLabel(&quot;W\u0142a\u015Bciwo\u015Bci&quot;);</span>
<span class="nc" id="L87">	GridBagConstraints propertiesLabelConstraints = new GridBagConstraints();</span>
<span class="nc" id="L88">	propertiesLabelConstraints.insets = new Insets(0, 0, 5, 5);</span>
<span class="nc" id="L89">	propertiesLabelConstraints.gridx = 2;</span>
<span class="nc" id="L90">	propertiesLabelConstraints.gridy = 0;</span>
<span class="nc" id="L91">	frame.getContentPane().add(propertiesLabel, propertiesLabelConstraints);</span>

<span class="nc" id="L93">	productsList = new JList&lt;String&gt;();</span>
<span class="nc" id="L94">	productsList.setModel(productsListModel);</span>
<span class="nc" id="L95">	productsList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L96">	GridBagConstraints productsListContraints = new GridBagConstraints();</span>
<span class="nc" id="L97">	productsListContraints.insets = new Insets(0, 0, 5, 5);</span>
<span class="nc" id="L98">	productsListContraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L99">	productsListContraints.gridx = 0;</span>
<span class="nc" id="L100">	productsListContraints.gridy = 1;</span>
<span class="nc" id="L101">	productsList.addMouseListener(new MouseAdapter() {</span>
	    @Override
	    public void mousePressed(MouseEvent e) {
<span class="nc" id="L104">		EventArguments arguments = new EventArguments(GraphicalView.this, productsList.getSelectedValue());</span>
<span class="nc" id="L105">		ingredientsListener.actionPerformed(arguments);</span>
<span class="nc" id="L106">	    }</span>
	});
<span class="nc" id="L108">	frame.getContentPane().add(productsList, productsListContraints);</span>

<span class="nc" id="L110">	final JList&lt;String&gt; ingredientsList = new JList&lt;String&gt;();</span>
<span class="nc" id="L111">	ingredientsList.setModel(ingredientsListModel);</span>
<span class="nc" id="L112">	ingredientsList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L113">	GridBagConstraints ingredientsListConstraints = new GridBagConstraints();</span>
<span class="nc" id="L114">	ingredientsListConstraints.insets = new Insets(0, 0, 5, 5);</span>
<span class="nc" id="L115">	ingredientsListConstraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L116">	ingredientsListConstraints.gridx = 1;</span>
<span class="nc" id="L117">	ingredientsListConstraints.gridy = 1;</span>
<span class="nc" id="L118">	ingredientsList.addMouseListener(new MouseAdapter() {</span>
	    @Override
	    public void mousePressed(MouseEvent e) {
<span class="nc" id="L121">		EventArguments arguments = new EventArguments(GraphicalView.this, ingredientsList.getSelectedValue());</span>
<span class="nc" id="L122">		propertiesListener.actionPerformed(arguments);</span>
<span class="nc" id="L123">	    }</span>
	});
<span class="nc" id="L125">	frame.getContentPane().add(ingredientsList, ingredientsListConstraints);</span>

<span class="nc" id="L127">	final JList&lt;String&gt; propertiesList = new JList&lt;String&gt;();</span>
<span class="nc" id="L128">	propertiesList.setModel(propertiesListModel);</span>
<span class="nc" id="L129">	propertiesList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L130">	GridBagConstraints propertiesListConstraints = new GridBagConstraints();</span>
<span class="nc" id="L131">	propertiesListConstraints.insets = new Insets(0, 0, 5, 5);</span>
<span class="nc" id="L132">	propertiesListConstraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L133">	propertiesListConstraints.gridx = 2;</span>
<span class="nc" id="L134">	propertiesListConstraints.gridy = 1;</span>
<span class="nc" id="L135">	frame.getContentPane().add(propertiesList, propertiesListConstraints);</span>

<span class="nc" id="L137">	JButton makeOrderButton = new JButton(&quot;Zamów!&quot;);</span>
<span class="nc" id="L138">	GridBagConstraints makeOrderButtonConstraints = new GridBagConstraints();</span>
<span class="nc" id="L139">	makeOrderButtonConstraints.insets = new Insets(0, 0, 5, 0);</span>
<span class="nc" id="L140">	makeOrderButtonConstraints.gridx = 3;</span>
<span class="nc" id="L141">	makeOrderButtonConstraints.gridy = 1;</span>
<span class="nc" id="L142">	makeOrderButton.addMouseListener(new MouseAdapter() {</span>
	    @Override
	    public void mousePressed(MouseEvent e) {
<span class="nc" id="L145">		EventArguments arguments = new EventArguments(GraphicalView.this, productsList.getSelectedValue());</span>
<span class="nc" id="L146">		orderListener.actionPerformed(arguments);</span>
<span class="nc" id="L147">	    }</span>
	});
<span class="nc" id="L149">	frame.getContentPane().add(makeOrderButton, makeOrderButtonConstraints);</span>

<span class="nc" id="L151">	statusLabel = new JLabel(&quot;Status...&quot;);</span>
<span class="nc" id="L152">	GridBagConstraints statusLabelConstraints = new GridBagConstraints();</span>
<span class="nc" id="L153">	statusLabelConstraints.insets = new Insets(0, 0, 0, 5);</span>
<span class="nc" id="L154">	statusLabelConstraints.gridx = 0;</span>
<span class="nc" id="L155">	statusLabelConstraints.gridy = 2;</span>
<span class="nc" id="L156">	frame.getContentPane().add(statusLabel, statusLabelConstraints);</span>

<span class="nc" id="L158">	JButton customProductButton = new JButton(&quot;W\u0142asny produkt&quot;);</span>
<span class="nc" id="L159">	GridBagConstraints customProductButtonConstraints = new GridBagConstraints();</span>
<span class="nc" id="L160">	customProductButtonConstraints.insets = new Insets(0, 0, 0, 5);</span>
<span class="nc" id="L161">	customProductButtonConstraints.gridx = 1;</span>
<span class="nc" id="L162">	customProductButtonConstraints.gridy = 2;</span>
<span class="nc" id="L163">	frame.getContentPane().add(customProductButton, customProductButtonConstraints);</span>

<span class="nc" id="L165">	JButton endButton = new JButton(&quot;Zako\u0144cz&quot;);</span>
<span class="nc" id="L166">	GridBagConstraints endButtonConstraints = new GridBagConstraints();</span>
<span class="nc" id="L167">	endButtonConstraints.gridx = 3;</span>
<span class="nc" id="L168">	endButtonConstraints.gridy = 2;</span>
<span class="nc" id="L169">	endButton.addMouseListener(new MouseAdapter() {</span>
	    @Override
	    public void mouseClicked(MouseEvent e) {
<span class="nc" id="L172">		frame.dispose();</span>
<span class="nc" id="L173">	    }</span>
	});
<span class="nc" id="L175">	frame.getContentPane().add(endButton, endButtonConstraints);</span>

<span class="nc" id="L177">	frame.setVisible(true);</span>
<span class="nc" id="L178">    }</span>

    @Override
    public void showError(String description) {
<span class="nc" id="L182">	JOptionPane.showMessageDialog(frame, description);</span>
<span class="nc" id="L183">    }</span>

    private void refresh(DefaultListModel&lt;String&gt; listModel) {
<span class="nc" id="L186">	listModel.clear();</span>
<span class="nc" id="L187">    }</span>

    private void showOn(Set&lt;String&gt; content, DefaultListModel&lt;String&gt; listModel) {
<span class="nc bnc" id="L190" title="All 2 branches missed.">	for (String each : content) {</span>
<span class="nc" id="L191">	    listModel.addElement(each);</span>
	}
<span class="nc" id="L193">    }</span>

    @Override
    public void showProducts(Set&lt;String&gt; products) {
<span class="nc" id="L197">	refresh(productsListModel);</span>
<span class="nc" id="L198">	showOn(products, productsListModel);</span>
<span class="nc" id="L199">    }</span>

    @Override
    public void showProductIngredients(String productName, Set&lt;String&gt; ingredients) {
<span class="nc" id="L203">	showIngredients(ingredients);</span>
<span class="nc" id="L204">    }</span>

    @Override
    public void showIngredients(Set&lt;String&gt; ingredients) {
<span class="nc" id="L208">	refresh(ingredientsListModel);</span>
<span class="nc" id="L209">	refresh(propertiesListModel);</span>
<span class="nc" id="L210">	showOn(ingredients, ingredientsListModel);</span>
<span class="nc" id="L211">    }</span>

    @Override
    public void showIngredientProperties(String ingredientName, Map&lt;String, Unit&gt; properties) {
<span class="nc" id="L215">	propertiesListModel.clear();</span>

<span class="nc bnc" id="L217" title="All 2 branches missed.">	for (String each : properties.keySet()) {</span>
<span class="nc" id="L218">	    Unit unit = properties.get(each);</span>
<span class="nc" id="L219">	    propertiesListModel.addElement(each + &quot; [&quot; + unit.name() + &quot;]&quot;);</span>
	}
<span class="nc" id="L221">    }</span>

    @Override
    public String getSelectedForPreparationProductName() {
<span class="nc" id="L225">	return productsList.getSelectedValue();</span>
    }

    @Override
    public Map&lt;String, Float&gt; getPropertiesForIngredient(String ingredientName, Map&lt;String, Unit&gt; availableProperties) {
<span class="nc" id="L230">	final JFrame propertiesFrame = new JFrame(&quot;Ustaw właściowości składnika &quot; + ingredientName);</span>
<span class="nc" id="L231">	propertiesFrame.setType(Type.UTILITY);</span>
<span class="nc" id="L232">	propertiesFrame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L233">	propertiesFrame.setBounds(new Rectangle(300, 300));</span>
<span class="nc" id="L234">	Container contentPane = propertiesFrame.getContentPane();</span>
<span class="nc" id="L235">	int propertiesQuantity = availableProperties.size();</span>
<span class="nc" id="L236">	contentPane.setLayout(new GridLayout(propertiesQuantity + 1, 2));</span>

<span class="nc" id="L238">	final Map&lt;String, JTextField&gt; propertiesValuesFields = new HashMap&lt;String, JTextField&gt;(propertiesQuantity);</span>

<span class="nc bnc" id="L240" title="All 2 branches missed.">	for (String eachPropertyName : availableProperties.keySet()) {</span>
<span class="nc" id="L241">	    Unit propertyUnit = availableProperties.get(eachPropertyName);</span>
<span class="nc" id="L242">	    contentPane.add(new JLabel(eachPropertyName + &quot; [&quot; + propertyUnit + &quot;]&quot;));</span>

<span class="nc" id="L244">	    JTextField valueField = new JTextField();</span>
<span class="nc" id="L245">	    propertiesValuesFields.put(eachPropertyName, valueField);</span>
<span class="nc" id="L246">	    contentPane.add(valueField);</span>
	}

<span class="nc" id="L249">	JButton okButton = new JButton(&quot;Zatwierdź&quot;);</span>
<span class="nc" id="L250">	okButton.addActionListener(new ActionListener() {</span>
	    @Override
	    public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L253" title="All 2 branches missed.">		if (areAllTextFieldsFilled(propertiesValuesFields)) {</span>
<span class="nc" id="L254">		    propertiesFrame.dispose();</span>
		}
<span class="nc" id="L256">	    }</span>
	});
<span class="nc" id="L258">	contentPane.add(okButton);</span>

<span class="nc" id="L260">	propertiesFrame.setVisible(true);</span>

	// while(!areAllTextFieldsFilled(propertiesValuesFields)) {
	//
	// }

<span class="nc" id="L266">	return toValuesMap(propertiesValuesFields);</span>
    }

    private Map&lt;String, Float&gt; toValuesMap(Map&lt;String, JTextField&gt; propertiesValuesFields) {
<span class="nc" id="L270">	Map&lt;String, Float&gt; result = new HashMap&lt;String, Float&gt;();</span>

<span class="nc bnc" id="L272" title="All 2 branches missed.">	for (String eachName : propertiesValuesFields.keySet()) {</span>
<span class="nc" id="L273">	    JTextField textField = propertiesValuesFields.get(eachName);</span>

<span class="nc" id="L275">	    result.put(eachName, Float.valueOf(textField.getText()));</span>
	}

<span class="nc" id="L278">	return result;</span>
    }

    private boolean areAllTextFieldsFilled(Map&lt;String, JTextField&gt; propertiesValuesFields) {
<span class="nc bnc" id="L282" title="All 2 branches missed.">	for (String eachName : propertiesValuesFields.keySet()) {</span>
<span class="nc" id="L283">	    JTextField textField = propertiesValuesFields.get(eachName);</span>

<span class="nc bnc" id="L285" title="All 2 branches missed.">	    if (textField.getText().isEmpty()) {</span>
<span class="nc" id="L286">		return false;</span>
	    }
	}
<span class="nc" id="L289">	return true;</span>
    }

    @Override
    public void showOperationStatus(Status status, String description) {
<span class="nc" id="L294">	statusLabel.setText(&quot;[&quot; + status.name() + &quot;] &quot; + description);</span>
<span class="nc" id="L295">    }</span>

    @Override
    public String getNewProductName() {
<span class="nc" id="L299">	return null;</span>
    }

    @Override
    public Set&lt;String&gt; getNewProductIngredients(Set&lt;String&gt; availableIngredients) {
<span class="nc" id="L304">	return null;</span>
    }

    @Override
    public void addProductsListener(ProductsListener productsListener) {
<span class="nc" id="L309">	this.productsListener = productsListener;</span>
<span class="nc" id="L310">	this.productsListener.actionPerformed(new EventArguments(this));</span>
<span class="nc" id="L311">    }</span>

    @Override
    public void addIngredientsListener(IngredientsListener ingredientsListener) {
<span class="nc" id="L315">	this.ingredientsListener = ingredientsListener;</span>
<span class="nc" id="L316">    }</span>

    @Override
    public void addOrderListener(OrderListener orderListener) {
<span class="nc" id="L320">	this.orderListener = orderListener;</span>
<span class="nc" id="L321">    }</span>

    @Override
    public void addPropertiesListener(PropertiesListener propertiesListener) {
<span class="nc" id="L325">	this.propertiesListener = propertiesListener;</span>
<span class="nc" id="L326">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (2015-02-11 22:36:32)</div></body></html>